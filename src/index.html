<!DOCTYPE HTML>
<html>
<head>
<title>Testing conversion unit</title>


<!-- Load json -->
<script src="sbmlUnits.json"></script>
<script src="simpleUnits.json"></script>

<!-- Load example -->
<script src="../cases/correct examples.js"></script>
<script src="../cases/incorrect examples.js"></script>

<script src="index.js"></script>

<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="style.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script type="text/javascript" src="http://insilicobio.ru/mathjax/MathJax.js?config=TeX-MML-AM_HTMLorMML"> </script>
</head>
<body id="top">
<div class="w3-container">
<span class="w3-button w3-circle"><a href="#calculate"><i class="fa fa-calculator w3-large" aria-hidden="true"></i></a></span>
<h1>Navigate</h1>
<ul id="navigate" class="w3-ul w3-hoverable w3-border">
</ul>
</div>
<hr/>
<div id="content" class="w3-container">
</div>

<div>
<p class="w3-bottom w3-padding">
  <a href="#top" class="w3-right  w3-button w3-circle w3-blue-grey"><i class="fa fa-arrow-up"></i></a>
</p>  
</div>

<div id="calculate" class="w3-container w3-margin" style="padding-bottom: 60px">
<div class="w3-row-padding">
  <div class="w3-quarter">
    <select id="unit1" class="w3-select w3-border">
      <option value="">unit1</option>
    </select>
  </div>
  <div class="w3-quarter">
    <select id="op" class="w3-select w3-border">
      <option value="*">*</option>
      <option value="/">/</option>
    </select>
  </div>
  <div class="w3-quarter">
    <select id="unit2" class="w3-select w3-border">
      <option value="">unit2</option>
      </select> 
  </div>  
  <div class="w3-quarter">
   <span class="w3-button w3-circle" onclick="calculate()"><i class="fa fa-calculator w3-xxlarge"></i></span>
  </div>
</div>
<div id="resultCalculate">
</div>
</div>
<script>
'use strict'
create_content(examples, "w3-green");
create_content(incorExamples, "w3-red");
function create_content(exampleList, navigateStyle){
  let content = document.getElementById("content"),
      nav = document.getElementById("navigate"),
      listCalc1 = document.getElementById("unit1"), 
      listCalc2 = document.getElementById("unit2"); 

  exampleList.forEach(function(item) {
    let li = document.createElement("li");
      li.classList.add(navigateStyle);
      let link = document.createElement("a");
      link.setAttribute("href", "#"+item);
      link.appendChild(document.createTextNode(item));
      li.appendChild(link);
    nav.appendChild(li);

    let option = document.createElement("option");
      option.appendChild(document.createTextNode(item));
      option.setAttribute("value", item)
      listCalc1.appendChild(option);
      listCalc2.appendChild(option.cloneNode(true));

    createInformationBlock(content, item, Unit.parseFromString(item));
  });
}

function createInformationBlock(content, title, un) { 

    let container = document.createElement("div");

    let head = document.createElement("h2");
    head.setAttribute("id", title)
    head.appendChild(document.createTextNode("Input "));
      let span = document.createElement("span");
      span.classList.add("w3-blue-gray", "w3-padding-small", "w3-large");
      span.appendChild(document.createTextNode(title));
      head.appendChild(span);
    container.appendChild(head);

    head = document.createElement("h3");
    head.appendChild(document.createTextNode("Unit-object after parse "));
    container.appendChild(head);

    let parseJsonUnit = document.createElement("textarea");
    parseJsonUnit.appendChild(document.createTextNode(JSON.stringify(un, null, 2)));
    container.appendChild(parseJsonUnit);

    head = document.createElement("h3");
    head.appendChild(document.createTextNode("Unit-object to string " ));
      span = document.createElement("span");
      span.classList.add("w3-blue-gray", "w3-padding-small", "w3-small");
      span.appendChild(document.createTextNode(un.toString()));
      head.appendChild(span);
    container.appendChild(head);

    head = document.createElement("h3");
    head.appendChild(document.createTextNode("Unit-object hash "));
      span = document.createElement("span");
      span.classList.add("w3-blue-gray", "w3-padding-small", "w3-small");
      span.appendChild(document.createTextNode(un.toHash()));
      head.appendChild(span);
    container.appendChild(head);
    
    head = document.createElement("h3");
    head.appendChild(document.createTextNode("Unit-object after conver to sbmlUnit"));
    container.appendChild(head);
    let sbmlUnitTextarea = document.createElement("textarea");
    sbmlUnitTextarea.appendChild(document.createTextNode(JSON.stringify(un.toSbmlUnits(), null, 2)));
    container.appendChild(sbmlUnitTextarea);
    
    head = document.createElement("h3");
    head.appendChild(document.createTextNode("Unit definition"));
    container.appendChild(head);
    let defUnitTextarea = document.createElement("textarea");
    let sbmlUnit = un.toSbmlUnitDefinition();
    if (typeof(sbmlUnit) != "string")
      defUnitTextarea.appendChild(document.createTextNode( stripDOM(new XMLSerializer().serializeToString(sbmlUnit))) );
    else  
      defUnitTextarea.appendChild(document.createTextNode(sbmlUnit));
    container.appendChild(defUnitTextarea);
    
    let math = document.createElement("div");
    math.appendChild(document.createTextNode("$$"+un.toTex()+"$$"));
    container.appendChild(math);
    
   

    /*Simp*/

    let simpDiv = document.createElement("div");
    let simpBtn = document.createElement("span");
    simpBtn.classList.add("w3-button",  "w3-blue-grey", "w3-round");
    simpBtn.appendChild(document.createTextNode("simplify"));
    simpBtn.setAttribute("onclick", "simp(event, '"+String(title)+"')");
    simpDiv.appendChild(simpBtn);
    simpDiv.appendChild(document.createElement("div"));
    container.appendChild(simpDiv);

     container.appendChild(document.createElement("hr"));

    content.appendChild(container);
}
function stripDOM(cont) {
	cont = cont.replace(/></g, ">\n<");
	return cont;
} 

function calculate() {
  console.log("Start calc");
  let unit1 = Unit.parseFromString(document.getElementById("unit1").value);
  let unit2 = Unit.parseFromString(document.getElementById("unit2").value);
  let content = document.getElementById("resultCalculate");
  let newUnit;

  if (document.getElementById("op").value == "*") {
    newUnit = unit1.multiply(unit2);
  }
  else {
    newUnit = unit1.divide(unit2);
  }
  //let nameOp = document.getElementById("op").value == "*" ? 'multiply' : 'divide';
  let title = document.getElementById("unit1").value + document.getElementById("op").value + document.getElementById("unit2").value;

  content.innerHTML = "";

  createInformationBlock(content, newUnit.toString(), newUnit);

  MathJax.Hub.Queue(["Typeset",MathJax.Hub]);

  console.log("End calc");


}

function simp(event, nameUnit) {
  event.target.nextSibling.innerHTML = "";
  createInformationBlock(event.target.nextSibling, nameUnit, Unit.parseFromString(nameUnit).simplify());

MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
}

</script>


</body>
</html>